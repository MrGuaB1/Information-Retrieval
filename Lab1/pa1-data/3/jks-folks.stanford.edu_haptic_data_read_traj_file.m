function trajdata read_traj_file filename this function reads a file in the traj format described at http jks folks stanford edu haptic_data the function returns a struct with one field for each metadata field found in the file and additional fields called t x y z forcex forcey forcez which represent the actual trajectory found in this file author dan morris function trajdata read_traj_file filename trajdata struct open the input file f fopen filename r if f 1 return end this token signals the beginning of the data last_comment_token data_start loop until we reach the end of the metadata while 1 curline fgetl f have we reached the end of the metadata if 0 isempty strfind curline last_comment_token break end find any field value tokens on this line results regexp curline s+ tokens if we didn t find anything of the form field value go on to the next line if isempty results continue end grab the values from this token field results 1 1 value results 1 2 nval count sscanf value f convert the value to a number if we can if count 0 trajdata setfield trajdata field nval else trajdata setfield trajdata field value end end now read all the data format repmat f 1 trajdata columns trajdata data textscan f format now convert the data into individual column vectors trajdata t trajdata data 1 trajdata x trajdata data 2 trajdata y trajdata data 3 trajdata z trajdata data 4 trajdata forcex trajdata data 5 trajdata forcey trajdata data 6 trajdata forcez trajdata data 7 clean up fclose f
