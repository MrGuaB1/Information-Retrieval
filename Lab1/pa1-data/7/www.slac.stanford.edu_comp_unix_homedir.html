unix afs home directory security stanford linear accelerator center home directory in afs slac computing unix at slac updated 16 march 2009 afs home directories security issues slac has traditionally encouraged a policy of open exchange of data and programs in its computer systems however as the internet has grown and applications have increased in complexity this policy needs some updating to provide the proper level of computer and data security user home directories in afs have historically been wide open for read access from other users at slac for example fs listacl vanilla access list for u sf vanilla is normal rights system slac rl system administrators rlidwka system authuser rl vanilla rlidwka the problematic entries are system slac which means any machine in the slac ip address ranges and system authuser which means any one in the world with a slac afs token while rl only allows reading and listing there are many applications that assume a different file security model than the per directory one that afs supplies this causes problems when the application assumes that setting a file with unix permissions of rw for user read write only makes it reasonably secure when in fact it may be readable by many other users in the past sccs has gone to some lengths to improve the security of specific apps ssh vnc x11 but as the number and complexity of applications increases this simply becomes unmanageable starting on march 18 2009 specific directories that have known security issues will have the system slac and system authuser permissions removed sccs has been doing this for ssh and vnc directories for several years this just expands the list to mozilla mysql and gaim the directories pgp and gnupg were added in march 2012 other directories will be added as deemed appropriate in addition we would encourage you to start tightening down the afs acls on your own as much as possible in particular for any application specific subdirectories in your home directory that may contain private data remove the troublesome acl entries in order to do this with the minimum possible disruption sccs has provided a tool called batten to automate as much of this as possible please consider using this tool in at least it's minimum mode to secure your home directory batten has two different modes of use do the minimum possible and do the most possible in the minimum mode only directories that start with a dot have their acl's modified in maximum mode all directories including the user's home directory get more restricted acl's batten in maximum mode also moves the user's k5login forward and procmailrc into a system slac readable directory and makes symlinks to allow ssh login and email forwarding to continue working using batten by default batten does nothing put print out a list of the commands it would run once it prints out a list you are happy with you use the g option to actually execute those commands for example batten bin sh batten is running in test mode this output can be edited and feed to bin sh cd u v vanilla mkdir system usr afsws bin fs setacl dir system acl system anyuser none system authuser none system slac rl usr afsws bin fs setacl dir openmpi acl system anyuser none system authuser none system slac none usr afsws bin fs setacl dir mozilla acl system anyuser none system authuser none system slac none usr afsws bin fs setacl dir dotfiles acl system anyuser none system authuser none system slac none usr afsws bin fs setacl dir hepix scs acl system anyuser none system authuser none system slac none usr afsws bin fs setacl dir metacity acl system anyuser none system authuser none system slac none usr afsws bin fs setacl dir gnome desktop acl system anyuser none system authuser none system slac none usr afsws bin fs setacl dir gnome acl system anyuser none system authuser none system slac none usr afsws bin fs setacl dir eggcups acl system anyuser none system authuser none system slac none usr afsws bin fs setacl dir environ scs acl system anyuser none system authuser none system slac none usr afsws bin fs setacl dir private acl system anyuser none system authuser none system slac none the best way to use batten is to tweak the command line options until you are satisfied with the results and then use the g option to actually execute the commands this will provide a back out file called batten revert in your home directory that will undo all the commands if needed for more detailed information see the batten man page booker c bense
