usr bin perl w vi set ts 4 libstrip a utility to optimize libraries for specific executables copyright c 2001 david a schleef ds schleef org this program is free software you can redistribute it and or modify it under the terms of version 2 of the gnu general public license as published by the free software foundation this is a surprisingly simple script that gets a list of unresolved symbols in a list of executables specified on the command line and then relinks the uclibc shared object file with only the those symbols and their dependencies this results in a shared object that is optimized for the executables listed and thus may not work with other executables example optimizing uclibc for busybox compile uclibc and busybox as normal then in this directory run libstrip path to busybox after the script completes there should be a new libuclibc 0.9 5 so in the current directory which is optimized for busybox how it works the uclibc makefiles create libuclibc so by first creating the ar archive libc a with all the object files then links the final libuclibc so by using ld shared whole archive we take advantage of the linker command line option undefined which pulls in a symbol and all its dependencies and so relink the library using undefined for each symbol in place of whole archive the linker script is used only to avoid having very long command lines topdir this is the name of the default ldscript for shared libs the file name will be different for other architectures ldscript usr lib ldscripts elf_i386 xs my syms my allsyms my s while exec shift argv print exec n syms nm dynamic exec for s syms chomp s if s m 8 buv my x $1 if grep m x allsyms unshift allsyms x open ldscript ldscript print ldscript include ldscript n for s allsyms print ldscript extern s n gcc s nostdlib wl warn common shared o libuclibc 0.9 5 so wl soname libc so 0 wl script ldscript topdir libc libc a topdir libc tmp libgcc need a
