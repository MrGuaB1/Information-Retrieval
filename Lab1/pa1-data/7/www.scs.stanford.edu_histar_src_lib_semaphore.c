include inc stdio h include inc syscall h include inc semaphore h include errno h initialize semaphore object sem to value if pshared then share it with other processes int sem_init sem_t sem int pshared unsigned int value if value sem_value_max errno einval return 1 if pshared errno enosys return 1 jthread_mutex_init &sem sem_lock sem sem_value value return 0 free resources associated with semaphore object sem int sem_destroy sem_t sem return 0 wait for sem being posted int sem_wait sem_t sem while 1 jthread_mutex_lock &sem sem_lock if sem sem_value 0 sem sem_value jthread_mutex_unlock &sem sem_lock return 0 jthread_mutex_unlock &sem sem_lock go to sleep and try to reacquire when woken sys_sync_wait &sem sem_value 0 uint64 0 test whether sem is posted int sem_trywait sem_t sem int r jthread_mutex_lock &sem sem_lock if sem sem_value 0 errno eagain r 1 else sem sem_value r 0 jthread_mutex_unlock &sem sem_lock return r post sem int sem_post sem_t sem jthread_mutex_lock &sem sem_lock if sem sem_value sem_value_max errno erange jthread_mutex_unlock &sem sem_lock return 1 sem sem_value++ if sem sem_value 1 sys_sync_wakeup &sem sem_value jthread_mutex_unlock &sem sem_lock return 0 get current value of sem and store it in sval int sem_getvalue sem_t sem int sval sval sem sem_value return 0 open a named semaphore name with open flaot oflag sem_t sem_open const char name int oflag cprintf sem_open not implemented n errno enosys return sem_t 0 close descriptor for named semaphore sem int sem_close sem_t sem cprintf sem_close not implemented n errno enosys return 1 remove named semaphore name int sem_unlink const char name cprintf sem_unlink not implemented n errno enosys return 1
