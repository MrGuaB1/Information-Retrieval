function sk spirit_kernel mc nk sk spirit_kernel mc nk compute the spirit kernel for a calibration region mc mc calibration region nk kernel size should be odd like 5 sk spirit kernel sk is nk nk nc nc in size nx ny nc size mc set up a matrix with all of the calibration data nd for kk 1 nc nd nd im2col mc kk nk nk sliding end regularization parameter from miki lustig's code lambda norm nd nd fro size nd 2 0.01 initialize kernel sk zeros nk nk nc nc offset of the synthesized sample for first coil ndx1 floor nk nk 2 1 calculate weights for each channel for k 1 nc index of synthesized sample for coil k ndx ndx1 k 1 nk nk find weights by removing corresponding column and fitting to it a nd 1 ndx 1 nd ndx 1 end ata a a temp inv ata eye size ata lambda a nd ndx add a zero placeholder at synthesized sample so we can implement as convolution later temp temp 1 ndx 1 0 temp ndx end save kernel sk k reshape temp nk nk nc end end
