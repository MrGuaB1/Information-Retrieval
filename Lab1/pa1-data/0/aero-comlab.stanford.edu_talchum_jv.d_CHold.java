import java io import java net import java util public class chathandler implements runnable protected socket socket public chathandler socket socket this socket socket protected datainputstream datain protected dataoutputstream dataout protected thread listener public synchronized void start if listener null try datain new datainputstream new bufferedinputstream socket getinputstream dataout new dataoutputstream new bufferedoutputstream socket getoutputstream listener new thread this listener start catch ioexception ignore public synchronized void stop if listener null try if listener thread currentthread listener interrupt listener null dataout close catch ioexception ignored protected static vector handlers new vector public void run try handlers addelement this while thread interrupted string message datain readutf string name new string listener getname string mess new string name message broadcast mess catch eofexception ignored catch ioexception ex if listener thread currentthread ex printstacktrace finally handlers removeelement this stop protected void broadcast string message synchronized handlers enumeration enum handlers elements while enum hasmoreelements chathandler handler chathandler enum nextelement try handler dataout writeutf message handler dataout flush catch ioexception ex handler stop
