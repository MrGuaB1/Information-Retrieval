motor control for the portable skin stretch device for shinsei motor and driver number 55520 clear all initialize phidgets i o board if libisloaded phidget21 loadlibrary phidget21 phidget21matlab h end attach phidgets i o board ptr libpointer int32ptr 0 calllib phidget21 cphidgetinterfacekit_create ptr handle get ptr value calllib phidget21 cphidget_open handle 1 attach phidgets encoder ptr2 libpointer int32ptr 0 calllib phidget21 cphidgetencoder_create ptr2 handle2 get ptr2 value calllib phidget21 cphidget_open handle2 1 run control code if calllib phidget21 cphidget_waitforattachment handle 2500 0 && calllib phidget21 cphidget_waitforattachment handle2 2500 0 dataptr libpointer int32ptr 0 speed_volts 1 0 direction_volts 1 0 ts 0.01 sec time_len 1 sec num_points time_len ts t zeros 1 num_points dest_tolerance 0.1 deg kp 0.5 step_amp 20 deg sin_amp 20 deg sin_freq 0.5 hz tic pause 0.025 timestamp 0.025 start loop for i 1 num_points while timestamp ts i pause ts 2 timestamp toc end get current location calllib phidget21 cphidgetencoder_getposition handle2 0 dataptr encoder i get dataptr value pos i double encoder i 360 5000 convert encoder counts to deg t i timestamp control calcs pos_desired i step_amp pos_desired i sin_amp sin 2 pi sin_freq timestamp diff pos_desired i pos i if abs diff dest_tolerance speed_volts i 0 direction_volts i 0 else speed_volts i abs kp diff direction_volts i sign diff end setmotorspd speed_volts i direction_volts i handle end else disp could not attach interfacekit end clean up setmotorspd 0 0 handle calllib phidget21 cphidget_close handle calllib phidget21 cphidget_delete handle calllib phidget21 cphidget_close handle2 calllib phidget21 cphidget_delete handle2
