how can i count all optical photons generated in an event g4userstackingaction can be utilized not only for stack management but also for counting particles in an event here is an example in your stackingaction you will see all primaries and secondaries at your classifynewtrack method here you can examine whether the new track is optical photon thus you can count all of them in the current event you will be informed whenever the urgent stack becomes empty via your newstage method if you do not use waiting stack it means the end of event don t forget to reset your counter at preparenewevent method a sample implementation of g4userstackingaction is the following header file t01stackingaction hh ifndef t01stackingaction_h define t01stackingaction_h 1 include g4userstackingaction hh class t01stackingaction public g4userstackingaction public t01stackingaction virtual t01stackingaction public virtual g4classificationofnewtrack classifynewtrack const g4track atrack virtual void newstage virtual void preparenewevent private g4int gammacounter endif source file t01stackingaction cc include t01stackingaction hh include g4ios hh include g4particledefinition hh include g4particletypes hh include g4track hh t01stackingaction t01stackingaction gammacounter 0 t01stackingaction t01stackingaction g4classificationofnewtrack t01stackingaction classifynewtrack const g4track atrack if atrack getdefinition g4opticalphoton opticalphotondefinition particle is optical photon if atrack getparentid 0 particle is secondary gammacounter++ return furgent void t01stackingaction newstage g4cout number of gamma produces in this event gammacounter g4endl void t01stackingaction preparenewevent gammacounter 0 once you create above you have to instanciate this class object in your main and set it to your runmanager makoto asai
