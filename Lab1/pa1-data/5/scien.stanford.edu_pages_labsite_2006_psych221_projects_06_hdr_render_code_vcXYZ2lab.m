function lab vcxyz2lab xyz whitepoint useoldcode lab vcxyz2lab xyz whitepoint flag author imageval purpose convert xyz values into ciel a b values with respect to the whitepoint this routine is based on the matlab image toolbox routines makecform and applycform the code we used for many years to is contained in the comment fields xyz can be in either xw or rgb format whitepoint a 3 vector of the xyz values of the white point lab values are returned in the same format rgb or xw as the input xyz read about cielab formulae are taken from wyszecki and stiles page 167 or other standard texts if ienotdefined xyz error no data end if ienotdefined whitepoint error a whitepoint is required for conversion to cielab end if ienotdefined useoldcode useoldcode 0 end if exist makecform 2 useoldcode this is where we want to be but it only exists in the relatively recent matlab routines cform makecform xyz2lab whitepoint whitepoint lab applycform xyz cform return else older matlab versions 6.5 1 don t have makecform or applycform so we have our own code here set the white point values if length whitepoint 3 error whitepoint must be a three vector else xn whitepoint 1 yn whitepoint 2 zn whitepoint 3 end if ndims xyz 3 r c w size xyz x xyz 1 xn x x y xyz 2 yn y y z xyz 3 zn z z lab zeros r c 3 elseif ndims xyz 2 x xyz 1 xn y xyz 2 yn z xyz 3 zn allocate space lab zeros size xyz end find out points 0.008856 xx find x 0.008856 yy find y 0.008856 zz find z 0.008856 compute l values fx fy fz represent cases 0.008856 fy y yy y y 1 3 lab 1 116 y 16 lab yy 1 903.3 fy compute a b values fx 7.787 x xx 16 116 fy 7.787 fy 16 116 fz 7.787 z zz 16 116 x x 1 3 z z 1 3 x xx fx y yy fy z zz fz lab 2 500 x y lab 3 200 y z return lab in the appropriate shape currently it is a xw format if the input had three dimensions then we need to change it to that format if ndims xyz 3 lab xw2rgbformat lab r c end end return
