this code is from the following paper pe debevec and j malik recovering high dynamic range radiance maps from photographs proceedings of siggraph 1997 acm press acm siggraph 369 378 1997 gsolve m solve for imaging system response function given a set of pixel values observed for several pixels in several images with different exposure times this function returns the imaging system's response function g as well as the log film irradiance values for the observed pixels assumes zmin 0 zmax 255 arguments z i j is the pixel values of pixel location number i in image j b j is the log delta t or log shutter speed for image j l is lamdba the constant that determines the amount of smoothness w z is the weighting function value for pixel value z returns g z is the log exposure corresponding to pixel value z le i is the log film irradiance at pixel location i function g le gsolve z b l w n 256 a zeros size z 1 size z 2 n 1 n size z 1 b zeros size a 1 1 include the data fitting equations k 1 for i 1 size z 1 for j 1 size z 2 wij w z i j 1 a k z i j 1 wij a k n i wij b k 1 wij b j b i j to b j k k 1 end end fix the curve by setting its middle value to 0 a k 129 1 k k 1 include the smoothness equations for i 1 n 2 a k i l w i 1 a k i 1 2 l w i 1 a k i 2 l w i 1 k k 1 end solve the system using svd x a b g x 1 n le x n 1 size x 1
